@page "/randomcompetitors"
@inject ICompetitiorsService _competitorsService

<PageTitle>Random Competitors</PageTitle>

<h1>Random Competitors</h1>
<div class="container-md">
    <p class="text-body">Get a random competitor from all competitors with minimum one valid result. </p>
</div>

@if (Competitions == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <div class="container-md">
        <select class="form-control selectpicker" @onchange="OnCompItSelected" disabled="@(!string.IsNullOrEmpty(Competitor))" >
            <option>--select--</option>
            @foreach (var item in Competitions.OrderBy(t => t.StartDate))
            {
                <option value="@item.Id">@item.Name</option>
            }
            </select>
    </div>
}

@if (Competitors == null )
{
    <div class="container-md">
        <p><em>Select a competion</em></p>
    </div>
}
else
{
    <div class="container-md">
        <button class="btn btn-primary" disabled="@(!Competitors.Any())" @onclick="GetRandomCompetitor">Get competitor</button>
    </div>

    <div class="container-md">
        <h2>@Competitor</h2>
    </div>
}



@code {
    private List<Competition>? Competitions;
    private List<string>? Competitors;
    private string Competitor = string.Empty;
    private Random random = null!;

    protected override async Task OnInitializedAsync()
    {
        Competitions = await _competitorsService.GetCompetitions();
    }

    protected async Task OnCompItSelected(ChangeEventArgs e)
    {
        Competitors = await _competitorsService.GetCompetititors(int.Parse(e.Value.ToString()));
    }

    protected async Task GetRandomCompetitor()
    {
        var next = new Random(DateTime.Now.Millisecond).Next(0, Competitors.Count);
        Competitor = Competitors.ElementAt(next);
        Competitors.RemoveAt(next);
    }
}
